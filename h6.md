# Palvelinten hallinta - h6

[Tehtävänanto](http://terokarvinen.com/2018/aikataulu-%E2%80%93-palvelinten-hallinta-ict4tn022-3004-ti-ja-3002-to-%E2%80%93-loppukevat-2018-5p)

Käytin tehtävässä omaa [Windows 10 Pro työasemaani](https://www.microsoft.com/fi-fi/p/windows-10-pro/df77x4d43rkt/48DN) ja [Oracle VM VirtualBoxia](https://www.virtualbox.org/),
jossa [Xubuntu 18.04.1 64-bit](https://xubuntu.org/download#lts) sekä [Ubuntu Server 16.04.5 LTS (Xenial Xerus)](http://releases.ubuntu.com/16.04/). Koneen prosessori: Intel Core i5 4690K @ 3.50GHz.

Olin viimeviikolla kipeänä, joten suoritan tehtävän loppuun 04.12.2018.

## "Asenna LAMP Saltilla."

#### L = Linux

Käytän siis VirtualBox VM Linux Xubuntu 18.04.1 64-bit käyttäjärjestelmänä. Katsoin, että herra-orja rakennelma toimii. Asensin siis orjan Ubuntu palvelin VM:lle ja herran Xubuntu VM:lle - ohjeet herra-orja asennukseen [täältä](http://terokarvinen.com/2018/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux). Testasin vain, että herran yhteys orjaan oli kunnossa:

$ sudo salt '*' test.ping

![test.ping](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/125..PNG?raw=true)

Pingi = True. Yhteys on kunnossa. Seuraavaksi lähdin asentamaan apachea manuaalisesti Ubuntu palvelimelle.

#### A = Apache 

##### Manuaalisesti

Tarkoituksena oli asentaa Apache2 web-palvelin ja laittaa käyttäjien kotisivut toimimaan. Asensin ensin Apachen:

$ sudo apt-get -y install apache2

Katsoin masterin (Xubuntu) selaimesta, että orjan (Ubuntu Server) web-palvelin toimii:

![apache2_default](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/126.png?raw=true)

Apache on toiminnassa. Sitten laitoin käyttäjän kotisivut toimimaan. Ensin annoin käyttäjille oikeudet tehdä kotisivuja kotihakemistoon:

$ sudo a2enmod userdir

Käynnistin Apachen uudelleen, jotta asetukset tulisivat voimaan:

$ sudo service apache2 restart

Sitten tein esimerkkisivut käyttäjälle. Loin publix_html -kansion ja sinne index.html:

$ mkdir -p /home/ubuntupalvelin/public_html

$ cd /home/ubuntupalvelin/public_html

$ nano index.html

Katsoin masterin selaimesta miten toimii:

![users_website](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/127..png?raw=true)

Käyttäjien kotisivut toimii.

##### Automaattisesti

Sitten tein saman Saltilla. Poistin kaikki käsintekemäni testauksen ja aloin tekemään palapalalta:

$ rm -r /home/ubuntupalvelin/public_hmtl

$ sudo apt-get -y purge apache2

Sitten menin masteri koneelle (Xubuntu) ja loin /srv/salt -kansioon apache kansion:

$ sudo mkdir -p /srv/salt/apache

Menin apache kansion sisään ja sinne tein index.html -tiedoston, jonka sisään kirjoitin Foo is Bar:

$ sudoedit index.html

Loin myös init.sls -tiedoston:

$ sudoedit init.sls

Kirjoitin sinne yamlilla apachen2 asennuksen. Lisäsin apache tilan top.sls "base" ympäristön ja orjan "lamp_orja" alle. Kaikki muut tilat poistin top.sls:stä. Sitten kokeilin:

$ sudo salt '*' state.highstate

![salt_apache_install](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/128.PNG?raw=true)

Apache2 asentui Saltin mukaan onnistuneesti. Tarkistin vielä masterin selaimesta orjan IP:llä. Apache vastasi orjan IP:stä. Sitten annoin orjan käyttäjille oikeuden tehdä kotisivuja kotihakemistoon. Lisäsin ensin index.html, niin että se menee salt -kansiosta käyttäjän "ubuntupalvelin" kotihakemistoon. Laitoin myös komennon "a2enmod userdir" toimimaan salt-tilassa. Latoin myös service.running:lla Apachen pyörimään aina palvelimella sekä käynnistymään uudelleen, jotta asetukset tulisivat voimaan. Laitoin apache2 myös watchiin.

![apache_state_fail](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/129.PNG?raw=true)

Salt ajoi kaiken onnistuneesti! Katsoin vielä masterin selaimesta näkyykö käyttäjän "ubuntupalvelin" kotisivuja. Käyttäjän kotisivuja ei näkynyt. Ongelma oli siinä, että en määritelly public_html -kansion luontia init.sls -tiedostoon (Tein sen file.directory:lla). Korjasin file.managed -polun /home/ubuntupalvelin/index.html /home/ubuntupalvelin/public_html/index.html:ksi. Ajoin uudelleen jonka jälkeen onnistui Saltin mukaan. Tarkistin orjan "ubuntupalvelin" käyttäjän sivujen toiminnan masterin selaimesta. Selaimessa näkyy "Foo is Bar".

![apache_state](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/130.PNG?raw=true)

![users_website_salt](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/131.png?raw=true)


