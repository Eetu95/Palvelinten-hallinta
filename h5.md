# Palvelinten hallinta - h5

[Tehtävänanto](http://terokarvinen.com/2018/aikataulu-%E2%80%93-palvelinten-hallinta-ict4tn022-3004-ti-ja-3002-to-%E2%80%93-loppukevat-2018-5p)

Käytin tehtävässä omaa [Windows 10 Pro työasemaani](https://www.microsoft.com/fi-fi/p/windows-10-pro/df77x4d43rkt/48DN) ja [Oracle VM VirtualBoxia](https://www.virtualbox.org/),
jossa [Xubuntu 18.04.1 64-bit](https://xubuntu.org/download#lts) ja [Windows 10 64 bit - Edge VM](https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/). Koneen prosessori: Intel Core i5 4690K @ 3.50GHz.

## a) "Säädä Windowsia Saltilla siten, että Windows on orja ja Linux on herra."

Tehtävän aloitus: 26.11.2018 klo 11.04

Olin valmiiksi ladannut VirtualBox imagen [Windows 10 64-bit - MSEdge](https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/) ja importannut sen VirtualBoxiin.

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/114.PNG?raw=true)

Tein Linux Xubuntu 18.04.1 64-bit VM:stä masterin. Päivitin ja asensin salt-masterin Linuxiin:

$ sudo apt-get update

$ sudo apt-get upgrade

$ sudo apt-get -y install salt-master

Tarkistin IP-osoitteen, sillä tulen tarvitsemaan sitä myöhemmin:

$ hostname -I

Kokeilin vielä nopeasti salt-master-mininion toimivuutta paikallisesti Xubuntu VM:ssä. Asensin myös salt-minionin:

$ sudo apt-get -y install salt-minion

Otin aikaisemmin tekemäni käyttäjän 'minion1' ja otin siihen ssh:lla yhteyden. Koska minion1 käyttäjällä on myös sudo oikeudet, pysyin
sillä muokkaamaan /etc/salt/minion -tiedoston konfiguraatioita. Laitoin siis masterin IP-osoitteen ja ID:n kohdilleen (ID ei pakollinen)

$ sudo echo -e 'master: (master ip) \nid: minion1'|sudo tee /etc/salt/minion

Käynnistin minionin uudestaan:

$ sudo systemctl restart salt-minion.service

Suljin ssh-yhteyden ja käynnistin vielä masterin uudestaan:

$ sudo systemctl restart salt-master.service

Sitten katsoin oliko hyväksymättömiä avaimia masterilla:

$ sudo salt-key -A

Ilmoituksessa näkyi yksi hyväksymätön avain 'minion1', joten hyväksyin sen (y). Sitten kokeilin vastaako orja:

$ sudo salt minion1 cmd.run 'whoami'

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/115.PNG?raw=true)

Vastaus tuli, varmistuttiin että rakenne toimii.

Sitten asensin Windows 10 VM:ään Salt minionin, ohjeet --> http://terokarvinen.com/2018/control-windows-with-salt

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/116.png?raw=true)

Latasin Windows salt-minion -asennuspaketin suoraan [SaltStackin virallisilta sivuilta](https://docs.saltstack.com/en/latest/topics/installation/windows.html). Valitsin tietenkin Python3 AMD64: Salt-Minion-2018.3.3-AMD64-Setup.exe|md5, uusin versio. Ladattuani paketin varoitti Windows Defender paketin mahdollisesta haitallisuudesta järjestelmääni, ajoin paketin silti. Asennusohjelma käynnistyi, etenin niin pitkään kunnes ohjelma kysyi masterin IP-osoitetta ja minion ID:tä. Syötin kyseiset tiedot (pidin oletusasetukset muuten) ja jatkoin eteenpäin. Tämän jälkeen alkoi Salt Minionin asennus Windowsille. Asennuksen jälkeen tuli ilmoitus että Salt Minion on asennettu. Menin siis seuraavaksi katsomaan löysikö Linux master winion1 -avaimen:

$ sudo salt-key -A

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/117.PNG?raw=true)

Salt-avain löytyi! Testasin vielä:

$ sudo salt winion1 test.ping

Pingi toimii.

Tehtävän lopetus: 26.11.2018 klo 12.02


