# Palvelinten hallinta - h3

[Tehtävänanto](http://terokarvinen.com/2018/aikataulu-%E2%80%93-palvelinten-hallinta-ict4tn022-3004-ti-ja-3002-to-%E2%80%93-loppukevat-2018-5p)

Käytin tehtävässä omaa [Windows 10 Pro työasemaani](https://www.microsoft.com/fi-fi/p/windows-10-pro/df77x4d43rkt/48DN) ja [Oracle VM VirtualBoxia](https://www.virtualbox.org/), jossa [Xubuntu 18.04.1 64-bit](https://xubuntu.org/download#lts), [Kali Linux Xfce 64 Bit](https://xubuntu.org/download#lts) ja [Ubuntu Server 16.04.5 LTS](http://releases.ubuntu.com/16.04/). Koneen prossu: Intel Core i5 4690K @ 3.50GHz.

### b) "MarkDown. Tee tämän tehtävän raportti MarkDownina. Helpointa on tehdä raportti samaan GitHub-varastoon kuin Salt-modulit. Tiedostoon .md-pääte. Tyhjä rivi tekee kappalejaon, risuaita ‘#’ tekee otsikon, sisennys merkitsee koodinpätkän."

### c) "Laita /srv/salt/ gittiin. Tee uusi moduli. Kloonaa varastosi toiselle koneelle (tai poista /srv/salt ja palauta se kloonaamalla) ja jatka sillä."

Tehtävän aloitus: 11.11.2018 klo 21.37

Asennetaan Git työkalu:

$ sudo apt-get -y install git

Vaihdoin vanhan /srv/salt -kansion nimeksi /srv/salt1. Tarkoituksena oli siirtää salt1 -kansion tilat uuteen GitHubista kloonattuun
salt repositoryyn.

$ sudo mv /srv/salt /srv/salt1

Olin jo aikaisemmin tunnilla laittanut /srv/salt -kansion gittiin, joten kloonasin tämän salt repon sieltä Xubuntu VM:ään /srv -kansioon.

$ sudo git clone https://github.com/Eetu95/salt.git

Sitten siirsin kaikki tilat vanhasta /srv/salt1 -kansiosta uuteen /srv/salt -kansioon:

$ sudo cp -r /srv/salt1/apache2/ srv/salt

$ sudo cp -r /srv/salt1/namebasedvh/ srv/salt

$ sudo cp -r /srv/salt1/php/ srv/salt

$ sudo cp -r /srv/salt1/skel/ srv/salt

$ sudo cp -r /srv/salt1/ufw/ srv/salt

Sitten tein uuden tilan /srv/salt:iin:

$ sudo mkdir hello

Menin hello kansioon ja tein sinne init.sls -tilan:

$ sudoedit init.sls

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/75.PNG?raw=true)

Tein vielä helloworld.txt -tiedoston, johon kirjoitin "Hello World!". Kokeilin tilan toimivuutta paikallisella orjalla:

$ sudo salt 'minion1' state.apply hello

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/76.PNG?raw=true)

Tila ajettu onnistuneesti! Sitten testasin:

$ cat /tmp/helloworld.txt

CLI tulosti "Hello World!".

Sitten tallensin ja lähetin muutokset GitHubiin:

$ sudo git add .

$ sudo git commit

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/77.PNG?raw=true)

Kirjoitin commit viestin. Sitten pullasin:

$ sudo git pull

Ja työnsin muutokset Githubiin:

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/78.PNG?raw=true)

Lisäsin taas commit viestin. Push:

$ sudo git push

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/79.png?raw=true)

Piti mennä poistamaan sähköposti suojausasetus GitHubista, jotta push onnistuisi.

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/80.PNG?raw=true)

Täppä pois. Sitten uudestaan git pull/push:

![alt text](https://github.com/Eetu95/Palvelinten-hallinta-ict4tn022-3004/blob/master/Kuvakaappaukset/81.PNG)

Onnistui!

### d) "Näytä omalla salt-varastollasi esimerkit komennoista ‘git log’, ‘git diff’ ja ‘git blame’. Selitä tulokset."

### e) "Tee tyhmä muutos gittiin, älä tee commit:tia. Tuhoa huonot muutokset ‘git reset –hard’. Huomaa, että tässä toiminnossa ei ole peruutusnappia."

### f) "Tee uusi salt-moduli. Voit asentaa ja konfiguroida minkä vain uuden ohjelman: demonin, työpöytäohjelman tai komentokehotteesta toimivan ohjelman. Käytä tarvittaessa ‘find -printf “%T+ %p\n”|sort’ löytääksesi uudet asetustiedostot."
